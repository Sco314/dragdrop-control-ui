<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Process Control System Drag-and-Click</title>
  <!-- 
    Copyright Â© 2025 Scott Sandvik. All Rights Reserved.
    This software and its content may not be reused, copied, or sold 
    without explicit permission from the author.
  -->
  <style>
    body { font-family: sans-serif; margin: 0; padding: 0; display: flex; height: 100vh; }
    #sidebar {
      width: 240px;
      background: #f5f5f5;
      padding: 10px;
      box-shadow: 2px 0 5px rgba(0,0,0,0.1);
      display: flex;
      flex-direction: column;
      gap: 10px;
    }
    #word-bank { background: #fff; border: 1px solid #ccc; padding: 10px; flex-grow: 1; overflow-y: auto; }
    .label { display: block; padding: 5px 10px; background: white; border: 2px solid #000; margin-bottom: 8px; cursor: pointer; user-select: none; transition: border 0.3s ease; }
    .label.used { opacity: 0.6; cursor: default; }
    #main-content { flex-grow: 1; position: relative; }
    #background {
      position: absolute;
      width: 100%;
      height: 100%;
      background: url("Process_Control_System_label_valve_liquid_level_sensor_controller.png") no-repeat center/contain;
    }
    .dropzone {
      border: 2px solid black;
      position: absolute;
      border-radius: 50%;
      width: 100px;
      height: 100px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      pointer-events: auto;
      transform: translate(-50%, -50%);
    }
    .dropzone .controls {
      display: none;
      position: absolute;
      bottom: 110%;
      left: 50%;
      transform: translateX(-50%);
      background: #fff;
      border: 1px solid #ccc;
      padding: 4px;
      border-radius: 4px;
    }
    .dropzone.teacher .controls { display: flex; gap: 4px; }
    #toolbar button { margin-bottom: 5px; width: 100%; }
    #score { font-weight: bold; margin-top: auto; }
  </style>
</head>
<body>
  <div id="sidebar">
    <div id="toolbar">
      <button id="modeBtn">Enter Teacher Mode</button>
      <button id="clearBtn">Clear All Hotspots</button>
      <button id="checkBtn">Check Answers</button>
    </div>
    <div id="word-bank"></div>
    <div id="score"></div>
  </div>
  <div id="main-content">
    <div id="background"></div>
  </div>
  <script>
    const labels = ["Valve", "Liquid Level Sensor", "Controller"];
    const background = document.getElementById("background");
    const wordBank = document.getElementById("word-bank");
    const modeBtn = document.getElementById("modeBtn");
    const clearBtn = document.getElementById("clearBtn");
    const checkBtn = document.getElementById("checkBtn");
    const scoreDisplay = document.getElementById("score");

    let isTeacher = false;
    let dropzones = [];
    let selectedLabel = null;
    const teacherPassword = "teach123";

    function createWordBank() {
      wordBank.innerHTML = "";
      labels.forEach(label => {
        const div = document.createElement("div");
        div.className = "label";
        div.textContent = label;
        div.addEventListener("click", () => {
          if (div.classList.contains("used")) return;
          selectedLabel = div;
          document.querySelectorAll(".label").forEach(l => l.style.border = "2px solid black");
          div.style.border = "2px solid blue";
        });
        wordBank.appendChild(div);
      });
    }

    function saveHotspots() {
      const data = dropzones.map(dz => ({ label: dz.dataset.correct, x: dz.dataset.x, y: dz.dataset.y }));
      localStorage.setItem("hotspots", JSON.stringify(data));
    }

    function loadHotspots() {
      const saved = localStorage.getItem("hotspots");
      if (saved) {
        const data = JSON.parse(saved);
        data.forEach(({ label, x, y }) => {
          addDropzone(parseFloat(x), parseFloat(y), label);
        });
      }
    }

    function addDropzone(x, y, label) {
      const dz = document.createElement("div");
      dz.className = "dropzone";
      dz.style.left = `${x}px`;
      dz.style.top = `${y}px`;
      dz.dataset.correct = label;
      dz.dataset.x = x;
      dz.dataset.y = y;

      const controls = document.createElement("div");
      controls.className = "controls";
      controls.innerHTML = `
        <button onclick="this.parentNode.parentNode.remove(); saveHotspots();">Delete</button>
        <button onclick="resizeZone(this.parentNode.parentNode, 1.2)">+</button>
        <button onclick="resizeZone(this.parentNode.parentNode, 0.8)">-</button>
      `;
      dz.appendChild(controls);

      dz.addEventListener("click", (e) => {
        e.stopPropagation();
        if (isTeacher) {
          dz.classList.toggle("teacher");
        } else if (selectedLabel) {
          if (selectedLabel.textContent === dz.dataset.correct) {
            dz.textContent = selectedLabel.textContent;
            dz.style.border = "2px solid green";
            selectedLabel.classList.add("used");
            selectedLabel.remove();
            selectedLabel = null;
          } else {
            selectedLabel.style.border = "2px solid yellow";
            setTimeout(() => selectedLabel.style.border = "2px solid black", 5000);
          }
        }
      });

      background.appendChild(dz);
      dropzones.push(dz);
      saveHotspots();
    }

    function resizeZone(zone, factor) {
      const currentSize = zone.offsetWidth;
      const newSize = currentSize * factor;
      zone.style.width = `${newSize}px`;
      zone.style.height = `${newSize}px`;
      saveHotspots();
    }

    background.addEventListener("click", e => {
      if (!isTeacher || !selectedLabel) return;
      const rect = background.getBoundingClientRect();
      const x = e.clientX - rect.left;
      const y = e.clientY - rect.top;
      addDropzone(x, y, selectedLabel.textContent);
    });

    clearBtn.onclick = () => {
      dropzones.forEach(dz => dz.remove());
      dropzones = [];
      saveHotspots();
    };

    modeBtn.onclick = () => {
      if (!isTeacher) {
        const input = prompt("Enter teacher password to enter Teacher Mode:");
        if (input !== teacherPassword) {
          alert("Incorrect password.");
          return;
        }
        isTeacher = true;
        modeBtn.textContent = "Switch to Student Mode";
        checkBtn.style.display = "none";
      } else {
        isTeacher = false;
        modeBtn.textContent = "Enter Teacher Mode";
        checkBtn.style.display = "inline-block";
        dropzones.forEach(dz => {
          dz.classList.remove("teacher");
        });
        createWordBank();
      }
    };

    checkBtn.onclick = () => {
      let correct = 0;
      dropzones.forEach(dz => {
        if (dz.textContent === dz.dataset.correct) correct++;
      });
      scoreDisplay.textContent = `Score: ${correct} / ${dropzones.length}`;
    };

    createWordBank();
    checkBtn.style.display = "inline-block";
    loadHotspots();
  </script>
</body>
</html>
